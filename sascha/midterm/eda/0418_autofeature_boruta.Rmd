---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code.

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*.

```{r}
library(nnet)
library(caret)
library(glmnet)
library(detectseparation)
ID.VAR <- "Order.ID"
TARGET.VAR <- "Sales"
sample.df <- read.csv("/Users/silmari/2023_statdm_project/sascha/data/superstore_noid.csv")
```

```{r}
library(data.table)
library(Boruta)
library(plyr)
library(dplyr)
library(pROC)
```

ref for boruta: <https://www.kaggle.com/code/jimthompson/boruta-feature-importance-analysis/report>

```{r}
# extract only candidate feture names
candidate.features <- setdiff(names(sample.df),c(ID.VAR,TARGET.VAR))
data.type <- sapply(candidate.features,function(x){class(sample.df[[x]])})
table(data.type)
```

```{r}
# deterimine data types
explanatory.attributes <- setdiff(names(sample.df),c(ID.VAR,TARGET.VAR))
data.classes <- sapply(explanatory.attributes,function(x){class(sample.df[[x]])})

# categorize data types in the data set?
unique.classes <- unique(data.classes)

attr.data.types <- lapply(unique.classes,function(x){names(data.classes[data.classes==x])})
names(attr.data.types) <- unique.classes
```

```{r}
# pull out the response variable
response <- sample.df$Sales

# remove identifier and response variables
sample.df <- sample.df[candidate.features]

# for numeric set missing values to -1 for purposes of the random forest run
for (x in attr.data.types$integer){
  sample.df[[x]][is.na(sample.df[[x]])] <- -1
}

for (x in attr.data.types$character){
  sample.df[[x]][is.na(sample.df[[x]])] <- "*MISSING*"
}
```

```{r}
set.seed(13)
bor.results <- Boruta(sample.df,response,
                   maxRuns=101,
                   doTrace=0)
```

```{r}
print(bor.results)
print(bor.results$finalDecision)
```

reference of the plot: <https://www.analyticsvidhya.com/blog/2016/03/select-important-variables-boruta-package/>

```{r}
plot(bor.results, xlab = "", xaxt = "n")
lz<-lapply(1:ncol(bor.results$ImpHistory),function(i)
bor.results$ImpHistory[is.finite(bor.results$ImpHistory[,i]),i])
names(lz) <- colnames(bor.results$ImpHistory)
Labels <- sort(sapply(lz,median))
axis(side = 1,las=2,labels = names(Labels),
at = 1:ncol(bor.results$ImpHistory), cex.axis = 0.7)
```

```{r}
bor.df <- attStats(bor.results)
class(bor.df)
print(bor.df)
```
